# GenSOLVER: from Order Scenarios to Computed Quantitative Solutions

- [GenSOLVER: from Order Scenarios to Computed Quantitative Solutions](#gensolver-from-order-scenarios-to-computed-quantitative-solutions)
  - [Core Definitions](#core-definitions)
  - [1. Positioning of GenSOLVER](#1-positioning-of-gensolver)
  - [2. Objectives of GenSOLVER](#2-objectives-of-gensolver)
  - [3. Formal Constraint Solving Model](#3-formal-constraint-solving-model)
    - [3.1 Variable Domains](#31-variable-domains)
    - [3.2 Monotonic Domain Refinement](#32-monotonic-domain-refinement)
  - [4. Equation Types](#4-equation-types)
  - [5. Unit-Aware Computation](#5-unit-aware-computation)
  - [6. Relationship to GenORDER Quantitative Semantics](#6-relationship-to-genorder-quantitative-semantics)
  - [7. Variable Propagation and Solving Strategy](#7-variable-propagation-and-solving-strategy)
  - [8. Logging and Explainability](#8-logging-and-explainability)
  - [9. Technical Architecture and Library Positioning](#9-technical-architecture-and-library-positioning)
  - [10. Relationship Between Rule-Based and AI-Based CDS](#10-relationship-between-rule-based-and-ai-based-cds)
  - [11. Summary of Responsibilities](#11-summary-of-responsibilities)
  - [Related Documents](#related-documents)
    - [Quick Reference by Topic](#quick-reference-by-topic)

---

## Core Definitions

| Term | Definition |
| ----- | ----- |
| *GenSOLVER* | The domain-independent quantitative constraint solving engine that computes numerically valid, unit-consistent solutions from the equation systems generated by GenORDER. |
| *Variable* | A symbolic placeholder representing a numeric value with an associated unit and domain range. |
| *Domain* | The bounded numerical range or discrete set of values a variable may assume. Domains form a lattice with ⊤ (unrestricted) and ⊥ (empty/infeasible). |
| *Constraint* | A mathematical restriction that limits the allowable values of one or more variables. |
| *Equation System* | A set of interdependent product and sum equations representing an Order Scenario. |
| *Propagation* | The process of reducing variable domains by enforcing constraints through equations. |
| *Soundness* | The property that every computed solution satisfies all constraints. |
| *Completeness* | The property that all valid solutions remain within the computed solution space. |
| *Monotonic Convergence* | The property that each propagation step monotonically reduces the domain until a fixed point is reached. |
| *Unit-Aware Calculation* | A calculation in which all numeric values retain their dimensional units throughout solving. |
| *Order Scenario* | A fully constrained, uniquely identifiable, computable clinical alternative representing one valid way to prescribe, prepare, and administer an order. (See [Core Domain Model](core-domain.md#core-definitions)) |
| *Operational Knowledge Rule (OKR)* | A fully structured, machine-interpretable, constraint-based representation of expert medication knowledge produced by GenFORM. (See [GenFORM](genform-free-text-to-operational-rules.md)) |
| *Selection Constraint* | A categorical constraint used to determine which OKRs apply to a given Order Context (Filter Stage). |
| *Calculation Constraint* | A quantitative constraint used to compute numerical values such as dose quantities, rates, volumes, or durations (Solver Stage). |

---

## 1. Positioning of GenSOLVER

GenSOLVER is the computational backend of the GenFORM – GenORDER – GenSOLVER chain. Where [GenFORM](genform-free-text-to-operational-rules.md) formalizes expert knowledge into Operational Knowledge Rules (OKRs) and [GenORDER](genorder-operational-rules-to-orders.md) transforms those rules into executable Order Scenarios, GenSOLVER performs all quantitative constraint resolution.

The full transformation chain is (see [Core Domain Model: The Transformation Pipeline](core-domain.md#the-transformation-pipeline)):

```text
GenFORM (OKRs) → Selection Constraints → Calculation Constraints → GenORDER (Order Scenarios) → GenSOLVER (Equation Systems) → Computed Numerical Solutions
```

GenSOLVER guarantees that all numerical outputs are mathematically valid, dimensionally consistent, and compliant with all applied constraints.

## 2. Objectives of GenSOLVER

GenSOLVER is designed to:

1. Solve sets of interdependent product and sum equations.
2. Handle exact arithmetic using rational numbers (BigRational).
3. Support variables whose domains are defined as discrete values or continuous ranges with increments.
4. Perform bidirectional calculation (any variable can be solved from known others).
5. Perform all calculations with full unit awareness.
6. Provide complete traceability of all calculation steps through human-readable logging.

GenSOLVER is domain independent and is used for medication, nutrition, and future treatment calculation scenarios.

## 3. Formal Constraint Solving Model

GenSOLVER implements a Constraint Satisfaction Problem (CSP) following Constraint Logic Programming (CLP) principles. See [Core Domain Model: Formal Constraint Execution Model](core-domain.md#formal-constraint-execution-model) for how this fits into the overall architecture.

### 3.1 Variable Domains

Each variable v has a domain D(v) defined as:

- A discrete value set, or
- A continuous interval: [min, max] with increment step

Domains always form a lattice:

- ⊤ = unrestricted domain
- ⊥ = empty domain (infeasible)

### 3.2 Monotonic Domain Refinement

All constraint propagation functions f satisfy:

```text
D₁ ⊑ D₂ ⇒ f(D₁) ⊑ f(D₂)
```

Thus:

- No valid solution is lost (soundness)
- Convergence is guaranteed (termination)
- All feasible solutions remain available (completeness)

## 4. Equation Types

GenSOLVER currently supports:

- **Product equations**: x = y × z
- **Sum equations**: x = y + z

These equations are sufficient to represent all quantitative dose, rate, volume, and concentration relations generated by GenORDER. See [GenORDER Appendix D.1: Equations Table](genorder-operational-rules-to-orders.md#appendix-d.1.-equations-table) for the complete set of 65 equations by dose type.

Each equation is solved bidirectionally: any variable can be derived from any valid combination of the others.

## 5. Unit-Aware Computation

All variables in GenSOLVER carry both:

- A numeric domain
- A unit expression

Unit expressions support:

- Multiplication (e.g., mg × kg)
- Division (e.g., mg / kg / day)
- Normalization and conversion

Exact fractional arithmetic is preserved:

- 1/3 × 3 = 1
- No floating-point rounding is introduced during symbolic solving

Unit validation is enforced at every calculation step. This capability is provided by Informedica.GenUnits.Lib.

## 6. Relationship to GenORDER Quantitative Semantics

GenORDER constructs all quantitative dose relations using the following canonical product relations (see [GenORDER Section 7: Quantitative Dose Semantics](genorder-operational-rules-to-orders.md#7.-quantitative-dose-semantics) and [Core Domain Model: Rule Hierarchy](core-domain.md#rule-hierarchy)):

- **Dose Per Time** = Dose Quantity × Frequency
- **Dose Total** = Dose Per Time × Order Duration
- **Dose Quantity** = Dose Rate × Administration Time
- **Base Dose** = Adjusted Dose × Adjustment Quantity

GenSOLVER receives these relations as explicit equations and resolves them simultaneously.

**Terminology alignment with Core Domain Model:**

| GenSOLVER Variable | Core Domain Term | Description |
| ------------------ | ---------------- | ----------- |
| DoseQuantity | Dose Quantity | Amount delivered per single administration |
| DosePerTime | Dose Per Time | Accumulated dose per unit time (e.g., per day) |
| DoseRate | Dose Rate | Continuous delivery speed (unit per time) |
| DoseTotal | Dose Total | Cumulative dose over entire order duration |
| AdjustedDose | Adjusted Dose | Dose normalized to Adjustment Unit |
| AdjustmentQuantity | Adjustment Quantity | Patient-specific value (e.g., 12 kg) |

## 7. Variable Propagation and Solving Strategy

GenSOLVER applies the following strategy:

1. Initialize all variable domains.
2. Apply all constraints (from Calculation Constraints in OKRs).
3. Propagate domains through equations.
4. Reduce domains monotonically.
5. Detect empty domains early and fail fast.
6. Iterate until a fixed point is reached.

This guarantees convergence even in highly interdependent equation networks.

## 8. Logging and Explainability

GenSOLVER logs:

- Each variable initialization
- Each constraint application
- Each domain refinement
- Each equation resolution

This allows:

- Full auditability
- Human-readable explanation of outcomes
- Regulatory traceability (MDR compliance)

## 9. Technical Architecture and Library Positioning

GenSOLVER is implemented as a domain library:

- **Informedica.GenSolver.Lib**

It depends on:

- **Informedica.GenUnits.Lib** for unit-aware arithmetic
- **Informedica.Utils.Lib** for basic primitives
- **Informedica.Logging.Lib** for trace output

It can run as:

- An embedded library
- A standalone agent-based microservice

See [GenORDER Appendix B.3: Libraries](genorder-operational-rules-to-orders.md#addendum-b.3.-genorder-libraries) for the complete library architecture.

## 10. Relationship Between Rule-Based and AI-Based CDS

GenSOLVER operates exclusively within the deterministic, rule-based constraint envelope defined by GenFORM and GenORDER. See [Core Domain Model: Rule-Based CDS](core-domain.md#rule-based-cds) and [AI-Based CDS](core-domain.md#ai-based-cds) for the broader context.

AI-Based CDS systems may:

- Suggest variable initializations
- Propose preferred solution regions

But they:

- Cannot violate GenSOLVER constraint envelopes
- Cannot override infeasible domains

Thus, GenSOLVER provides the mathematical safety layer for all hybrid CDS architectures.

## 11. Summary of Responsibilities

**GenFORM** (see [GenFORM: Free Text to Operational Rules](genform-free-text-to-operational-rules.md)):

- Formalizes expert knowledge
- Produces Operational Knowledge Rules (OKRs)
- Defines Patient Categories and Selection/Calculation Constraints

**GenORDER** (see [GenORDER: Operational Rules to Orders](genorder-operational-rules-to-orders.md)):

- Transforms OKRs into executable Order Scenarios
- Constructs symbolic equation systems
- Maps Order, Orderable, Component, and Item properties to variables

**GenSOLVER**:

- Solves all quantitative constraints
- Produces numerically exact, unit-consistent solutions
- Guarantees soundness, completeness, and traceability

## Related Documents

This GenSOLVER document is part of the GenPRES domain documentation. For the complete picture, refer to:

| Document | Description |
| -------- | ----------- |
| [Core Domain Model](core-domain.md) | High-level overview of the transformation pipeline, core definitions, and system architecture. |
| [GenFORM: Free Text to Operational Rules](genform-free-text-to-operational-rules.md) | How free-text expert knowledge is transformed into structured Operational Knowledge Rules (OKRs). |
| [GenORDER: Operational Rules to Orders](genorder-operational-rules-to-orders.md) | How OKRs are transformed into executable Order Scenarios. Includes the equation system that GenSOLVER solves. |

### Quick Reference by Topic

| Topic | Document Reference |
| ----- | ------------------ |
| Transformation Pipeline | [Core Domain Model](core-domain.md#the-transformation-pipeline) |
| Core Definitions | [Core Domain Model](core-domain.md#core-definitions) |
| Rule Types (Dose, Dilution, etc.) | [GenFORM Section 3](genform-free-text-to-operational-rules.md#3-sources-and-types-of-dose-rules) |
| Patient Category vs Patient | [Core Domain Model](core-domain.md#core-definitions) |
| Order Model (Orderable, Component, Item) | [GenORDER Section 6](genorder-operational-rules-to-orders.md#6.-order-model-(executable-structure)) |
| Dose Semantics | [GenORDER Section 7](genorder-operational-rules-to-orders.md#7.-quantitative-dose-semantics) |
| Complete Equation Table | [GenORDER Appendix D.1](genorder-operational-rules-to-orders.md#appendix-d.1.-equations-table) |
| Variable Definitions | [GenORDER Appendix C.2](genorder-operational-rules-to-orders.md#appendix-c.2.-order-model-table) |
